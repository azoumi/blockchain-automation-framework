apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: supplychaindemovalidator2ibft
  namespace: supplychaindemo-bes
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: supplychaindemovalidator2ibft
  chart:
    git: ssh://git@github.com/azoumi/blockchain-automation-framework.git
    ref: demo/besu
    path: platforms/hyperledger-besu/charts/node_validator 
  values:
    replicaCount: 1

    healthcheck:
      readinessthreshold: 100
      readinesscheckinterval: 5

    staticnodes:
      - "enode://5fe8fbaae5b342538620a503c2312f73d27ddff3c38d121f0b9ca3c5211ccd45832da5a0f58e15f2d209da1d19e3ee8e2781d88c25e3b0b91d44576495c3fbd4@54.171.205.179:15050"
      - "enode://a497484cf79a0ba66020ef1b786611bc047856439528326f4f9a6d823bf2d6ea010f397e4894e496037cbd5d5eeb8bc355fa442da6da89a7b2782df1f9c9db8f@54.171.205.179:15060"
      - "enode://c392ad909fd981d25a194042b191639e438cb03603611f428c8a35f34f5495d5590e83233ecaef3b84e6a043d949e0bcafde1819df483a8dab8aa8927ea9bf32@54.171.205.179:15070"
      - "enode://bd1f3ca3ba58698d415d83366207a4e810fc9acca40f55e1c142f115684b33c29dc7136e48a2484d84e97946ae8226a6a7607a2658c980e59caa3f9d92d7173e@54.171.205.179:15080"
      - "enode://e357effd59be4b9f5253dc850ebd5d3b6ce38078f7eb267deeea4f664d6526e9a461621986cbb1beb89b86868778086499e94058e0662d7f3093bf6432685d93@54.171.205.179:15010"
      - "enode://a1cae93216bb72c5229f53b4bd42858165510cc1e5919b78a81eb79a28cee65afdf98f95a89484b2b9d8edaec2b11f5297f1f8666a7c28ece30d3f024a7a363d@54.171.205.179:15020"
      - "enode://4301278c0b853794e72662f0efe29c046a54acbbd7e72a50a6ecfd713a9c2492a801fe6e734ddfc9ec7d87cc265c51b8399a02c9a2a296fd0dff444739086f49@54.171.205.179:15030"
      - "enode://17b2c49889de05b2cf2b6f1743a47d5fc6ad8f17bdeffe126777513771ca5863064ef5ad02c93f8e3eb6cc13e4532bb5ddb388ac7682a2796bae4eef1dd3bc11@54.171.205.179:15040"

    metadata:
      namespace: supplychaindemo-bes
      labels:

    ambassador:
      external_url_suffix: bs.dev2.aws.blockchaincloudpoc-develop.com

    liveliness_check:
      enabled: false

    proxy:
      provider: ambassador
      external_url: supplychaindemo.bs.dev2.aws.blockchaincloudpoc-develop.com
      p2p: 15060
      rpc: 15061

    images:
      node: hyperledger/besu:1.4.4
      alpineutils: hyperledgerlabs/alpine-utils:1.0

    node:
      name: validator2
      tls: True
      consensus: ibft
      mountPath: /etc/genesis
      servicetype: ClusterIP
      imagePullSecret: regcred
      ports:
        p2p: 30303
        rpc: 8545
        ws: 8546

    storage:
      storageclassname: awsstorageclass
      storagesize: 1Gi

    vault:
      address: http://vault.internal.dev2.aws.blockchaincloudpoc-develop.com:20001
      secretprefix: secret/supplychaindemo-bes/crypto/validator2
      serviceaccountname: vault-auth
      keyname: data
      tlsdir: tls
      role: vault-role
      authpath: besusupplychaindemo

    genesis: ewogICJjb25maWciOiB7CiAgICAiY2hhaW5JZCI6IDIwMTgsCiAgICAiY29uc3RhbnRpbm9wbGVmaXhibG9jayI6IDAsCiAgICAiY29udHJhY3RTaXplTGltaXQiOiAyMTQ3NDgzNjQ3LAogICAgImliZnQyIjogewogICAgICAiYmxvY2twZXJpb2RzZWNvbmRzIjogMiwKICAgICAgImVwb2NobGVuZ3RoIjogMzAwMDAsCiAgICAgICJyZXF1ZXN0dGltZW91dHNlY29uZHMiOiAxMAogICAgfQogIH0sCiAgIm5vbmNlIjogIjB4MCIsCiAgInRpbWVzdGFtcCI6ICIweDU4ZWU0MGJhIiwKICAiZ2FzTGltaXQiOiAiMHgxZmZmZmZmZmZmZmZmZiIsCiAgImRpZmZpY3VsdHkiOiAiMHgxIiwKICAiZXh0cmFEYXRhIjogIjB4Zjg3ZWEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGY4NTQ5NDExNzEyZjRjZDRjZDNjZWEwMmM3NTcyODZmMDUwNDRiMTM2ZjQ3MDQ5NDRkNjc5YTJkZGY1YjM1N2M1ZTFmMjJiOTY1NzEzMDM2ZjA3NWM4Njk5NGUzZDA0MGY3NTI0YWM4ZGM2YjBhMzExZjU0MWMyZDVmYmE0NjkyMjY5NGFlNmMzNzVhYjVlOWEyYmQ2MGNlNjc2NDE0OGQ2Y2FiNzFkNjMwYmQ4MDg0MDAwMDAwMDBjMCIKfQ==
